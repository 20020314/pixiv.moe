!function(a){function e(){c.column_num=f();for(var e="",g=0;g<c.column_num;g++)e+='<div class="'+b.column_className+'" style="width:'+b.column_width+"px; display:inline-block; *display:inline;zoom:1; margin-left:"+b.column_space/2+"px;margin-right:"+b.column_space/2+'px; vertical-align:top; overflow:hidden"></div>';return d.prepend(e),a("."+b.column_className,d)}function f(){var a=Math.floor(d.innerWidth()/(b.column_width+b.column_space));return 1>a&&(a=1),a}function g(d,e){if(a(d).length){c.$columns;a(d).each(function(c){if(!b.auto_imgHeight||2==b.insert_type)return 1==b.insert_type?i(a(d).eq(c),b.fadein&&e):2==b.insert_type&&j(a(d).eq(c),c,b.fadein&&e),!0;if("img"==a(this)[0].nodeName.toLowerCase()||a(this).find(b.img_selector).length>0){var f=new Image,g="img"==a(this)[0].nodeName.toLowerCase()?a(this).attr("src"):a(this).find(b.img_selector).attr("src");f.onload=function(){f.onreadystatechange=null,1==b.insert_type?i(a(d).eq(c),b.fadein&&e):2==b.insert_type&&j(a(d).eq(c),c,b.fadein&&e),f=null},f.onreadystatechange=function(){"complete"==f.readyState&&(f.onload=null,1==b.insert_type?i(a(d).eq(c),b.fadein&&e):2==b.insert_type&&j(a(d).eq(c),c,b.fadein&&e),f=null)},f.src=g}else 1==b.insert_type?i(a(d).eq(c),b.fadein&&e):2==b.insert_type&&j(a(d).eq(c),c,b.fadein&&e)})}}function h(a){g(a,!0)}function i(a,d){d?a.css("opacity",0).appendTo(c.$columns.eq(k())).fadeTo(b.fadein_speed,1):a.appendTo(c.$columns.eq(k()))}function j(a,d,e){e?a.css("opacity",0).appendTo(c.$columns.eq(d%c.column_num)).fadeTo(b.fadein_speed,1):a.appendTo(c.$columns.eq(d%c.column_num))}function k(){var b=c.$columns.eq(0).outerHeight(),d=0;return c.$columns.each(function(c){a(this).outerHeight()<b&&(b=a(this).outerHeight(),d=c)}),d}function l(){return a.waterfall.load_index++,b.getResource(a.waterfall.load_index,h)}function m(){clearTimeout(c._scrollTimer),c._scrollTimer=setTimeout(function(){var a=c.$columns.eq(k()),b=a.offset().top+a.outerHeight(),d=document.documentElement.scrollTop||document.body.scrollTop||0,e=document.documentElement.clientHeight||document.body.clientHeight||0;d>=b-e&&g(l(),!0)},100)}function n(){if(f()!=c.column_num){var a=c.$container.find(b.cell_selector);c.$columns.remove(),c.$columns=e(),g(a,!1)}}var b={column_width:210,column_className:"waterfall_column",column_space:-22,cell_selector:".cell",img_selector:"img",auto_imgHeight:!0,fadein:!0,fadein_speed:600,insert_type:1,getResource:function(a){}},c=a.waterfall={},d=null;c.load_index=0,a.fn.extend({waterfall:function(f){f=f||{},b=a.extend(b,f),d=c.$container=a(this),c.$columns=e(),g(a(this).find(b.cell_selector).detach(),!1),c._scrollTimer2=null,a(window).bind("scroll",function(){clearTimeout(c._scrollTimer2),c._scrollTimer2=setTimeout(m,300)}),c._scrollTimer3=null,a(window).bind("resize",function(){clearTimeout(c._scrollTimer3),c._scrollTimer3=setTimeout(n,300)})}}),c._scrollTimer=null}(jQuery);